I"é
<p><strong>Editor‚Äôs Note: This is mirrored from <a href="https://www.raywenderlich.com/181130/kitura-stencil-tutorial-how-to-make-websites-with-swift">RayWenderlich.com</a>.</strong></p>

<p>IBM‚Äôs <a href="http://kitura.io" rel="noopener" target="_blank">Kitura</a> is a very popular and exciting server framework, but did you know it can be used to create web apps?</p>

<p>In this tutorial on Kitura and <a href="https://github.com/kylef/Stencil" rel="noopener" target="_blank">Stencil</a>, you‚Äôll pick up from the <a href="https://www.raywenderlich.com/180721/kitura-tutorial-getting-started-with-server-side-swift" rel="noopener" target="_blank">first part</a> of this tutorial series and do the following:</p>

<ul>
  <li>Add the <code class="highlighter-rouge">Stencil</code> dependency to your project.</li>
  <li>Create a basic website interface.</li>
  <li>Add a route to your API for your website.</li>
  <li>Make your Swift code interact with HTML.</li>
</ul>

<p>If you‚Äôre new to Kitura, or haven‚Äôt set up CouchDB on your system yet, check out the <a href="https://www.raywenderlich.com/180721/kitura-tutorial-getting-started-with-server-side-swift">Server Side Swift with Kitura</a> tutorial first.</p>

<h2 id="getting-started">Getting Started</h2>

<p>Just like the previous tutorial, you‚Äôll need the following available to you:</p>

<ul>
  <li>MacOS 10.12 or higher</li>
  <li>Xcode 9.2 or newer</li>
  <li>CouchDB</li>
  <li>Basic familiarity with Terminal, as you‚Äôll use the command line quite a bit</li>
</ul>

<p>You also need to make sure CouchDB is running. If you installed CouchDB via Homebrew, open Terminal and enter this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew services start couchdb
</code></pre></div></div>

<p>If you get a message that says <code>successfully started</code> or <code>already started</code>, you‚Äôre good to go!</p>

<h2 id="running-the-starter-project">Running the Starter Project</h2>

<p>Use the <code class="highlighter-rouge">Download Materials</code> button at the top or bottom of this tutorial to download the starter project. This has additional files that <code class="highlighter-rouge">aren't</code> part of the previous tutorial, so you‚Äôll need to download this starter even if you‚Äôve completed the prior tutorial.</p>

<p>Open Terminal and navigate to the root directory for your project, where <code class="highlighter-rouge">Package.swift</code> lives. Then, enter the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>swift build
</code></pre></div></div>

<p>You should see a succession of logs followed by this at the end:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Compile Swift Module <span class="s1">'KituraWebInterface'</span> <span class="o">(</span>5 sources<span class="o">)</span>
Linking ./.build/x86_64-apple-macosx10.10/debug/KituraWebInterface
swift build
</code></pre></div></div>

<p>Input the following command and press Enter:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.build/debug/KituraWebInterface
</code></pre></div></div>

<p>You should see logs about starting the application, and a window may pop up asking you to allow incoming connections. If so, click <code class="highlighter-rouge">Allow</code>.</p>

<p>Next, open a new Terminal window and enter the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost:8080/acronyms <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"short": "AFK", "long": "Away from keyboard"}'</span>
</code></pre></div></div>

<p>Unless you‚Äôve already added this acronym, you should get a JSON response representing the new acronym. Then enter the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost:8080/acronyms
</code></pre></div></div>

<p>All of the acronyms stored in CouchDB will be displayed. If you completed the previous tutorial, you may see more than just the <code class="highlighter-rouge">AFK</code> acronym.</p>

<p>Before you generate the Xcode project, you‚Äôll add a few directories to organize your frontend app. Press <code class="highlighter-rouge">Control-C</code> to stop the app and carry on!</p>

<h2 id="how-the-backend-organizes-data">How the Backend Organizes Data</h2>

<p>Whenever you made a GET request via the browser, your backend searches these available routes:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/acronyms"</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">getAcronyms</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"/acronyms"</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">addAcronym</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="s">"/acronyms"</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">deleteAcronym</span><span class="p">)</span>
</code></pre></div></div>

<p>The API matches against each route by considering the HTTP verb, which in this case is <code>GET</code>, and the route path, which is <code>/acronyms</code>.</p>

<p>However, a user doesn‚Äôt think in HTTP terms ‚Äî they just want to see what they‚Äôre interested in. This is where the user interface comes in.</p>

<h2 id="how-the-web-frontend-organizes-data">How the Web Frontend Organizes Data</h2>

<p>The same routers that handle your data endpoints render your user interfaces. The only difference is the route‚Äôs closure returns HTML instead of JSON.</p>

<p>At the root of nearly any Kitura web app, you‚Äôll see two directories: <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">Views</code>. The <code class="highlighter-rouge">public</code> directory usually contains four subdirectories:</p>

<ul>
  <li><code class="highlighter-rouge">html</code>: Contains files for determining how the UI is put together.</li>
  <li><code class="highlighter-rouge">css</code>: Contains definitions for ‚Äúthemes‚Äù and how the content is styled.</li>
  <li><code class="highlighter-rouge">js</code>: Contains JavaScript files for onscreen user interaction and other under-the-hood functionality.</li>
  <li><code class="highlighter-rouge">img</code>: Contains images, cat pictures and memes mostly!</li>
</ul>

<p>The <code class="highlighter-rouge">public</code> directory holds only static files, but Kitura can do more than just serve static files.</p>

<p>Kitura uses a tool called <code class="highlighter-rouge">Stencil</code> to render webpages and populate dynamic page content based on information passed from your Swift API. Stencil lets you create templates to display content from your APIs in a predetermined format.</p>

<p>For example, suppose you want to add a title to a page indicating the current month. A na√Øve approach could look like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>The current month is December!<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>This works only 1/12th of the time: when it‚Äôs December!</p>

<p>What if your API could instead calculate the current month and provide a string from that calculation to use as the title? In your Swift code, you‚Äôd pass that string to the renderer, and your Stencil template might look like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>The current month is {{ currentMonth }}!<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Notice the curly braces? This is how you tell Stencil to insert information into the HTML from a context. The workflow for Stencil is essentially this:</p>

<ol>
  <li>Prepare data from your API.</li>
  <li>Set up a context: a dictionary of key/value pairs.</li>
  <li>Populate your context with the values you want to display.</li>
  <li>Render a template in your response, using a context.</li>
</ol>

<p>With this workflow, you never have to worry about manually updating your webpage content. Instead, it is generated dynamically from the API.</p>

<p>Stencil templates typically have the extension <code class="highlighter-rouge">.stencil</code> or <code class="highlighter-rouge">.html.stencil</code> and go in the <code class="highlighter-rouge">Views</code> directory. This is where Stencil looks for them when you tell it to render one.</p>

<h2 id="adding-the-stencil-dependency">Adding the Stencil Dependency</h2>

<p>Before you can use Stencil, you need to add it as a dependency for your project. Open <code class="highlighter-rouge">Package.swift</code> in Xcode, and replace its contents with the following. The only changes are below the two commented lines:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// swift-tools-version:4.1</span>
<span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
  <span class="nv">name</span><span class="p">:</span> <span class="s">"KituraWebInterface"</span><span class="p">,</span>
  <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/Kitura.git"</span><span class="p">,</span> <span class="o">.</span><span class="nf">upToNextMinor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"2.4.1"</span><span class="p">)),</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/HeliumLogger.git"</span><span class="p">,</span> <span class="o">.</span><span class="nf">upToNextMinor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"1.7.1"</span><span class="p">)),</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/Kitura-CouchDB.git"</span><span class="p">,</span> <span class="o">.</span><span class="nf">upToNextMinor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"2.1.0"</span><span class="p">)),</span>
    <span class="c1">// 1</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/Kitura-StencilTemplateEngine.git"</span><span class="p">,</span>
             <span class="o">.</span><span class="nf">upToNextMinor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"1.10.0"</span><span class="p">))</span>
  <span class="p">],</span>
  <span class="c1">// 2</span>
  <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span> <span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"KituraWebInterface"</span><span class="p">,</span>
                     <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Kitura"</span> <span class="p">,</span> <span class="s">"HeliumLogger"</span><span class="p">,</span> <span class="s">"CouchDB"</span><span class="p">,</span> <span class="s">"KituraStencil"</span><span class="p">])</span> <span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Here‚Äôs what the changes do:</p>

<ol>
  <li>You declare a dependency on Stencil, using its fully qualified Git URL.</li>
  <li>You add Stencil to your target, so it will link correctly.</li>
</ol>

<p>Save and close this file.</p>

<p>Open Terminal and navigate to the root project directory, which contains <code class="highlighter-rouge">Package.swift</code>, and enter this command:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">swift</span> <span class="n">build</span>
</code></pre></div></div>

<p>This will setup the new dependency on Stencil. Nice!</p>

<p><strong>Note</strong>: Stencil is not fully updated with the latest Swift changes so you‚Äôll probably see a host of warnings. They can safely be ignored.</p>

<p>You‚Äôre making excellent progress, but you have a little more to set up before you can get to coding.</p>

<h2 id="configuring-the-kitura-stencil-tutorial-project">Configuring the Kitura Stencil Tutorial Project</h2>

<p>You next need to set up some directories to keep your project organized.</p>

<p>Still in your project‚Äôs root directory in Terminal, enter the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>Views
<span class="nb">cd </span>Views
<span class="nb">touch </span>home.stencil
<span class="nb">touch </span>header.stencil
<span class="nb">touch </span>add.stencil
<span class="nb">cd</span> ..
</code></pre></div></div>

<p>You‚Äôve just created the <code class="highlighter-rouge">Views</code> directory, populated it with three template files and returned to the root directory.</p>

<p>Next, enter the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>public
<span class="nb">cd </span>public
<span class="nb">mkdir </span>css
<span class="nb">mkdir </span>img
<span class="nb">touch </span>css/index.css
<span class="nb">cd</span> ..
</code></pre></div></div>

<p>You‚Äôre simply creating the directory structure and empty files for now. You‚Äôll populate these files shortly.</p>

<p>Create a Swift file for handling the client route:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>Sources/KituraWebInterface/Routes/ClientRoutes.swift
</code></pre></div></div>

<p>Finally, open your project directory in Finder. You can do this most easily by entering in Terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open <span class="nb">.</span>
</code></pre></div></div>

<p>Find the file <code class="highlighter-rouge">kitura.jpg</code> in your downloaded materials and drag it into the <code class="highlighter-rouge">img</code> directory.</p>

<p>Your project directory should now look like this:</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-3.29.22-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-3.29.22-PM-650x421.png" alt="KituraWebInteface Project hierarchy" width="650" height="421" class="aligncenter size-large bordered wp-image-189711" /></a></p>

<p>Go back to Terminal, and execute the following commands from your project‚Äôs root directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>swift package generate-xcodeproj
open KituraWebInterface.xcodeproj
</code></pre></div></div>

<p>You should now have the following window open in Xcode:</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-3.58.30-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-3.58.30-PM-650x446.png" alt="KituraWebInterface Xcode first look" width="650" height="446" class="aligncenter size-large bordered wp-image-189713" /></a></p>

<p>Take a look at your File Hierarchy, and you‚Äôll notice everything is nicely organized.</p>

<p><strong>Note</strong>: Once again, ignore any warnings about Swift 4 conversions and deprecations. These are expected with the current version of Stencil.&lt;/div&gt;</p>

<p>There are only two more things you need to do before writing code. Just like in the previous tutorial, you need to set the current scheme‚Äôs executable so you can build and run the project in Xcode.</p>

<p>First, go to the <code class="highlighter-rouge">Select Scheme</code> dropdown and select <code class="highlighter-rouge">Edit Scheme</code>.</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2017/12/Screen-Shot-2017-12-22-at-1.14.52-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/01/Select_Edit_Scheme.png" alt="Select Edit Scheme on Kitura Stencil tutorial project" width="300" height="396" class="bordered aligncenter" /></a></p>

<p>In the window that pops up, click on the menu next to <code class="highlighter-rouge">Executable</code> and select <code class="highlighter-rouge">KituraWebInterface</code>. Then, click <code class="highlighter-rouge">Close</code> to dismiss the pop-up.</p>

<p><img src="https://koenig-media.raywenderlich.com/uploads/2018/02/Screen-Shot-2018-02-06-at-13.03.59-480x268.png" alt="Set executable" width="480" height="268" class="aligncenter size-medium bordered wp-image-186024" /></p>

<p>Next, click on the drop-down to the <code class="highlighter-rouge">right of</code> the <code class="highlighter-rouge">Select Scheme</code> dropdown, and select <code class="highlighter-rouge">My Mac</code> (if it‚Äôs not selected already).</p>

<p>Build and run. Then, open your web browser and go to <a href="http://localhost:8080" rel="noopener" target="_blank">http://localhost:8080</a> to make sure the Kitura home page loads.</p>

<p>Now, you‚Äôre finally ready to do some web coding!</p>

<h2 id="preparing-your-web-ui">Preparing Your Web UI</h2>

<p><strong>Note:</strong> Xcode isn‚Äôt the best tool for editing HTML, CSS and Stencil files. You can get basic syntax coloring via <code class="highlighter-rouge">Editor menu ‚ñ∏ Syntax ‚ñ∏ Coloring</code> and choosing the file type, but this won‚Äôt recognize Stencil tags. For a better experience, you can use <a href="https://marketplace.visualstudio.com/items?itemName=svanimpe.stencil" rel="noopener" target="_blank">this extension for Visual Studio Code</a> written by a Ray Wenderlich team member.</p>

<p>Open <code class="highlighter-rouge">index.css</code> and replace its contents with the following:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.menu-container</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#000</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'helvetica Neue'</span><span class="p">,</span> <span class="s2">'Helvetica'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="s1">"Lucida Grande"</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.menu</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#FFF</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">900px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.menu-add</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#000</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="n">space-around</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.menu-add-component</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#000</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="n">space-around</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">input</span><span class="nc">.button-primary</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#00B3E4</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#FFF</span><span class="p">;</span>
  <span class="nl">border-color</span><span class="p">:</span> <span class="no">black</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">4px</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">input</span><span class="nc">.acronym-field</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">border-color</span><span class="p">:</span> <span class="m">#333</span><span class="p">;</span>
  <span class="nl">border-width</span><span class="p">:</span> <span class="m">1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">::-webkit-input-placeholder</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">:-moz-placeholder</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">::-moz-placeholder</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">:-ms-input-placeholder</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#909</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">::-ms-input-placeholder</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Open Sans'</span><span class="p">,</span> <span class="s2">'Arial'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#909</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A complete discussion of CSS is outside the scope of this tutorial. However, this essentially sets various styles for the components you‚Äôll be adding in HTML. You also use a framework called <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout" rel="noopener" target="_blank"><code class="highlighter-rouge">FlexBox</code></a> to make it easier to organize content within a web page.</p>

<p>Next, open <code class="highlighter-rouge">header.stencil</code> and replace its contents with the following:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'menu-container'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'title'</span><span class="nt">&gt;&lt;h1&gt;</span>TIL: Today I Learned<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/img/kitura.jpg"</span><span class="nt">&gt;&lt;/h1&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>This showcases a key element of Stencil template files: composition. You can define small templates to reuse in larger templates inside of loops. Here, <code class="highlighter-rouge">header.stencil</code> will simply be included at the top of each page, but the next example will showcase just how useful Stencil templating can be.</p>

<p>Open <code class="highlighter-rouge">home.stencil</code>, and replace its contents with the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>TIL - Kitura<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/css/index.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span>
      <span class="na">href=</span><span class="s">"//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;amp;amp;subset=latin,latin-ext"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="c">&lt;!--1--&gt;</span>
    {% include "header.stencil" %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Existing Acronyms<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h3&gt;</span>Short Form<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h3&gt;</span>Long Form<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>The line below the comment labeled <code class="highlighter-rouge">&lt;!--1--&gt;</code> shows how Stencil allows dynamic content to be passed into the template.</p>

<p>To see what this actually looks like, you‚Äôll next write a route to render the page.</p>

<h2 id="adding-a-kitura-route-to-render-your-template">Adding a Kitura Route to Render your Template</h2>

<p>Open <code class="highlighter-rouge">ClientRoutes.swift</code> and enter the following:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">KituraStencil</span>
<span class="kd">import</span> <span class="kt">Kitura</span>

<span class="kd">func</span> <span class="nf">initializeClientRoutes</span><span class="p">(</span><span class="nv">app</span><span class="p">:</span> <span class="kt">App</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 1</span>
  <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">setDefault</span><span class="p">(</span><span class="nv">templateEngine</span><span class="p">:</span> <span class="kt">StencilTemplateEngine</span><span class="p">())</span>
  <span class="c1">// 2</span>
  <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">all</span><span class="p">(</span><span class="nv">middleware</span><span class="p">:</span> <span class="kt">StaticFileServer</span><span class="p">())</span>
  
  <span class="c1">// 3</span>
  <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
    <span class="c1">// 4</span>
    <span class="k">let</span> <span class="nv">context</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    <span class="c1">// 5</span>
    <span class="k">try</span> <span class="n">response</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="s">"home"</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here‚Äôs what that does, step by step:</p>

<ol>
  <li>With Kitura, you have a choice between templating engines. This tutorial uses Stencil, but you can choose from others such as <code class="highlighter-rouge">Mustache</code> or <code class="highlighter-rouge">Markdown</code>.</li>
  <li>Here you set up a handler to serve the static files in the <code class="highlighter-rouge">public</code> directory.</li>
  <li>This is actual definition for your route. Notice how you override the main home page path? This means this route will respond when you visit <code class="highlighter-rouge">&lt;a href="http://localhost:8080" rel="noopener" target="_blank"&gt;http://localhost:8080&lt;/a&gt;</code></li>
  <li>This is where you define the context to pass into your rendered response. The <code>render</code> function does not accept <code>nil</code> for a context; instead, you should always provide a context of type <code>[String: Any]</code>.</li>
  <li>Notice that, because you set Stencil as the default template engine, you can leave off the default <code class="highlighter-rouge">.stencil</code> extension when referring to templates.</li>
</ol>

<p>Now to add a router to render the response.</p>

<p>Open <code class="highlighter-rouge">Application.swift</code> and replace <code>finalizeRoutes(with:)</code> with this:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">func</span> <span class="nf">finalizeRoutes</span><span class="p">(</span><span class="n">with</span> <span class="nv">database</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
  <span class="nf">initializeAcronymRoutes</span><span class="p">(</span><span class="nv">app</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
  <span class="nf">initializeClientRoutes</span><span class="p">(</span><span class="nv">app</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
  <span class="kt">Log</span><span class="o">.</span><span class="nf">info</span><span class="p">(</span><span class="s">"Acronym routes created"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, whenever your application registers its routers with the main router, it will include this new router for your rendering response.</p>

<p>Build and run, open a web browser and visit <a href="http://localhost:8080" rel="noopener" target="_blank">http://localhost:8080</a>.</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.39.38-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.39.38-PM-650x430.png" alt="First served page" width="650" height="430" class="aligncenter size-large bordered wp-image-189715" /></a></p>

<p>You‚Äôve just rendered your first HTML template using Swift!</p>

<p>Next, you need to make your page display some acronyms.</p>

<h2 id="passing-a-context-to-stencil">Passing a Context to Stencil</h2>

<p>It would be great if the acronyms from your database were displayed on the webpage. To do that, you first need to place them in a context.</p>

<p>Open <code class="highlighter-rouge">ClientRoutes.swift</code> file, and replace the <code>get</code> route with this:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">database</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">database</span> <span class="p">{</span>
    <span class="c1">// 1</span>
    <span class="kt">Acronym</span><span class="o">.</span><span class="kt">Persistence</span><span class="o">.</span><span class="nf">getAll</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">database</span><span class="p">)</span> <span class="p">{</span> <span class="n">acronyms</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
      <span class="k">guard</span> <span class="k">let</span> <span class="nv">acronyms</span> <span class="o">=</span> <span class="n">acronyms</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">response</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">error</span><span class="p">?</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
        <span class="k">return</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nv">contextAcronyms</span><span class="p">:</span> <span class="p">[[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">acronym</span> <span class="k">in</span> <span class="n">acronyms</span> <span class="p">{</span>
        <span class="c1">// 2</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">acronym</span><span class="o">.</span><span class="n">id</span> <span class="p">{</span>
          <span class="c1">// 3</span>
          <span class="k">let</span> <span class="nv">map</span> <span class="o">=</span> <span class="p">[</span><span class="s">"short"</span><span class="p">:</span> <span class="n">acronym</span><span class="o">.</span><span class="n">short</span><span class="p">,</span> <span class="s">"long"</span><span class="p">:</span> <span class="n">acronym</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="n">id</span><span class="p">]</span>
          <span class="n">contextAcronyms</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// 4</span>
      <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">response</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="s">"home"</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="p">[</span><span class="s">"acronyms"</span><span class="p">:</span> <span class="n">contextAcronyms</span><span class="p">])</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="p">{</span>
        <span class="n">response</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here‚Äôs what this does:</p>

<ol>
  <li>First, you call <code>Persistence.getAll</code> to retrieve all of the acronyms.</li>
  <li>You‚Äôll soon add support for creating an <code>Acronym</code>, but for now, you only use those that already have an <code>id</code> within the database.</li>
  <li>In order for Stencil to read properties from your context, you must serialize them. Stencil doesn‚Äôt yet support automatic serialization through <code>Codable</code> so you do it the old fashioned way.</li>
  <li>Finally, you set the <code>contextAcronyms</code> using the key <code>"acronyms"</code>. Later on, you‚Äôll use this same key to access this array in HTML.&lt;/code&gt;</li>
</ol>

<p>Next, you must update <code class="highlighter-rouge">home.stencil</code> to use the new array you passed via the context. Replace the contents of <code>body</code> within <code class="highlighter-rouge">home.stencil</code> with the following:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
  {% include "header.stencil" %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Existing Acronyms<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Short Form<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Long Form<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="c">&lt;!--1--&gt;</span>
  {% for acronym in acronyms %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--2--&gt;</span>
        <span class="nt">&lt;h5&gt;</span>{{ acronym.short }}<span class="nt">&lt;/h5&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--3--&gt;</span>
        <span class="nt">&lt;p&gt;</span>{{ acronym.long }}<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  {% endfor %}
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>Here‚Äôs the play by play:</p>

<ol>
  <li>Here, you use the context values passed into Stencil: you loop through all available acronyms and create template HTML for each.</li>
  <li>In the same manner, you display the short version for each acronym.</li>
  <li>Finally, you display the long version.</li>
</ol>

<p>Build and run, and navigate your web browser to <a href="http://localhost:8080" rel="noopener" target="_blank">http://localhost:8080</a>.</p>

<p>Depending on how many acronyms you have stored in your database, your webpage should look something like the following:</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.57.07-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.57.07-PM-650x430.png" alt="Display acronyms" width="650" height="430" class="aligncenter size-large bordered wp-image-189717" /></a></p>

<p>As a final touch, you‚Äôll add a UI so you can add and remove acronyms through the web app.</p>

<h2 id="adding-a-template-for-creating-acronyms">Adding a Template for Creating Acronyms</h2>

<p>Open <code class="highlighter-rouge">add.stencil</code> and enter the following:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2&gt;</span>Add New Acronym<span class="nt">&lt;/h4&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Acronym<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"shortField"</span> <span class="na">class=</span><span class="s">"acronym-field"</span> <span class="na">name=</span><span class="s">"short"</span> <span class="na">placeholder=</span><span class="s">"e.g. BRB"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;label&gt;</span>Long Form<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"longField"</span> <span class="na">class=</span><span class="s">"acronym-field"</span> <span class="na">name=</span><span class="s">"long"</span> <span class="na">placeholder=</span><span class="s">"e.g. Be Right Back"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"button-primary"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Save Acronym"</span> <span class="na">onClick=</span><span class="s">"submitForm()"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>You‚Äôll use this HTML template at the top of the page to allow the user to create a new <code>Acronym</code>. In particular, look at the line for <code>button-primary</code>, which has <code>onClick</code> set to <code>submitForm</code>. You need to create a JavaScript function for this. At the end of the file, add the following:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="kd">function</span> <span class="nx">submitForm</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 1</span>
  <span class="kd">var</span> <span class="nx">short</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">shortField</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">long</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">longField</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">long</span> <span class="o">==</span> <span class="dl">""</span> <span class="o">||</span> <span class="nx">short</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 2</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Both fields must contain text!</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/acronyms</span><span class="dl">"</span><span class="p">);</span>
  <span class="c1">// 3</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// 5</span>
     <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// 4</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="dl">"</span><span class="s2">short</span><span class="dl">"</span><span class="p">:</span> <span class="nx">short</span><span class="p">,</span> <span class="dl">"</span><span class="s2">long</span><span class="dl">"</span><span class="p">:</span> <span class="nx">long</span> <span class="p">}));</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<p>Here‚Äôs what this does:</p>

<ol>
  <li>Here you access form fields and prepare to populate your JSON request to your API.</li>
  <li>Just as you placed object validation on the backend, it‚Äôs good practice to duplicate your validation on the front-end.</li>
  <li>Since your API is using Codable Routing, you need to set your content header appropriately.</li>
  <li>You send your JSON with this handy <code>stringify</code> function to serialize your data.</li>
  <li>When the request receives a response, you reload the page to update what you see in your list.</li>
</ol>

<p>Now you‚Äôll add this template to the home page.</p>

<p>Open <code class="highlighter-rouge">home.stencil</code> and find the line that has</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% include "header.stencil" %}
</code></pre></div></div>
<p>Add the following right after that line:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% include "add.stencil" %}
</code></pre></div></div>

<p>This will include everything you wrote in <code class="highlighter-rouge">add.stencil</code>. This is a great way to separate out reusable components.</p>

<p>Reload your webpage, it should look like this:</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.57.29-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-4.57.29-PM-650x430.png" alt="Add acronym" width="650" height="430" class="aligncenter size-large bordered wp-image-189718" /></a></p>

<p>Try using your fancy new UI to add a couple of new acronyms. After you click the <code class="highlighter-rouge">Save Acronym</code> button, you‚Äôll either see a refreshed page, or an alert if you didn‚Äôt enter text for both fields!</p>

<p>You‚Äôre almost at the finish line! You just need a way to delete acronyms.</p>

<h2 id="adding-delete-functionality">Adding Delete Functionality</h2>

<p>This is another place to take advantage of your templating abilities. Rather than create a UI where you enter an ID and then click delete for that acronym, wouldn‚Äôt it be nice to have a delete button next to each acronym?</p>

<p>Still in <code class="highlighter-rouge">home.stencil</code> file, replace everything inside the <code class="highlighter-rouge">body</code> tag with this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
  {% include "header.stencil" %}
  {% include "add.stencil" %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Existing Acronyms<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Short Form<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Long Form<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!--1--&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Delete Acronym<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  {% for acronym in acronyms %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h5&gt;</span>{{ acronym.short }}<span class="nt">&lt;/h5&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>{{ acronym.long }}<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="c">&lt;!--2--&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"menu-add-component"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"{{ acronym.id }}"</span> <span class="na">class=</span><span class="s">"button-primary one-line"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Delete"</span> <span class="na">onClick=</span><span class="s">"deleteAcronym(this.id)"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  {% endfor %}
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>Here‚Äôs what you added:</p>

<ol>
  <li>Add a header to reflect your options below.</li>
  <li>Add a button to delete the acronym on a given line. Notice that the <code>id</code> parameter makes use of the acronym‚Äôs <code>id</code>. This will be important shortly.</li>
</ol>

<p>Below all of your HTML, you need to add one more JavaScript function. Just before the <code>&lt;/body&gt;</code> tag, add the following:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="c1">// 1</span>
    <span class="kd">function</span> <span class="nx">deleteAcronym</span><span class="p">(</span><span class="nx">acronymID</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="c1">// 2</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">delete</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/acronyms/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">acronymID</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 3</span>
                <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<p>Here‚Äôs how this works:</p>

<ol>
  <li>The button‚Äôs ID is used as a parameter to tell your function which acronym you want to delete.</li>
  <li>You use this parameter to create the correct URL.</li>
  <li>When the request completes, you refresh the page to update the UI.</li>
</ol>

<p>Reload the page again. It should look like this:</p>

<p><a href="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-5.09.02-PM.png"><img src="https://koenig-media.raywenderlich.com/uploads/2018/03/Screen-Shot-2018-03-22-at-5.09.02-PM-650x430.png" alt="Final project screen" width="650" height="430" class="aligncenter size-large bordered wp-image-189720" /></a></p>

<p>Try deleting the acronyms you‚Äôve already typed. After you click the delete button, the page should update and show that you did in fact delete the acronym!</p>

<p>You‚Äôve just built a fully functional web application with a backend written in Swift! Pretty neat.</p>

<h2 id="where-to-go-from-here">Where to Go From Here?</h2>

<p>You can download the completed version of the project using the <code class="highlighter-rouge">Download Materials</code> button at the top or bottom of this tutorial. Because projects built using the Swift Package Manager (SPM) treat the <code class="highlighter-rouge">.xcodeproj</code> as disposable, it is not included. Run <code class="highlighter-rouge">swift package generate-xcodeproj</code> again to download the dependencies and generate an Xcode project.</p>

<p>Web templating is fun when you need to interface with your Swift API right away. I hope that Stencil helps you get on track for whatever it is you want to create, whether it‚Äôs a blog, a photo library or anything else you have in mind.</p>

<p>If you have any questions or comments, please join the forum discussion below!</p>

:ET